<?php
class AjaxController extends BackendAppController {
	var $name = 'Ajax';	var $components = array('Session', 'Auth');	//var $helpers = array('Form');
	function beforeFilter(){		parent::beforeFilter();	}
	/*Check the customer registation*/	function check_registration( $registration_no = null){		$this->layout = false;		$errors = array();		$name = "";		if(!empty($registration_no)){			$this->loadModel('Backend.Patient');			$record = $this->Patient->find('first', array(								'conditions'=>array('Patient.registration_no'=>$registration_no),								'fields'=>array('Patient.id','Patient.name')								)							);			if(!empty($record)){				$name = $record['Patient']['name'];			}		}		echo json_encode(array('errors'=>$errors, 'name'=>$name));		$this->autoRender = false;
	}		/*Upload files*/		function upload_image(){		$this->layout = false;		if($this->request->is('ajax') && !empty($this->data)){			$errors = array();			$status = false;			$file_name = "";			if(!empty($_FILES)){				$file_ext = array_reverse(explode('.', $_FILES['files']['name']));				$file_ext  = strtolower($file_ext[0]);				$allow_ext = array('jpg', 'jpeg', 'png', 'gif');				if(in_array($file_ext, $allow_ext) && $_FILES['files']['error'] == 0){					$imageSize = getimagesize($_FILES['files']['tmp_name']);					$file_name = 'temp-'.time().'.jpg';					/*Attachment Root Path*/					$tempImagePath = Configure::read('Temp.RelativePath').$file_name;					copy($_FILES['files']['tmp_name'],$tempImagePath);					$status = true;												}else{					$errors['error'] = "Please upload only JPG, PNG and GIF file";					}						}			echo json_encode(array('errors'=>$errors, 'file_name'=>$file_name, 'status'=>$status));		}		$this->autoRender = false;	}
};?>